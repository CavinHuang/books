
# å®æˆ˜-æ­å»ºå¼€å‘ç¯å¢ƒ
---

ç°åœ¨æˆ‘ä»¬å°±æ­£å¼è¿›å…¥äº†æˆ‘ä»¬çš„å®æˆ˜ï¼Œä¹Ÿæ˜¯å°å†Œå­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼šä» 0 åˆ° 1 å¼€å‘ä¸€ä¸ªå›¾è¡¨åº“ã€‚å‰ä¸€ç« å¯¹æˆ‘ä»¬è¦å¼€å‘çš„ä¸œè¥¿ Sparrowå·²ç»æœ‰äº†ä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚

åœ¨æ­£å¼å¼€å‘ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ­å»ºå¼€å‘ç¯å¢ƒï¼šä¸€ä¸ªåˆç†çš„å¼€å‘ç¯å¢ƒï¼Œä¼šå¤§å¤§æé«˜æˆ‘ä»¬å†™ä»£ç çš„æ•ˆç‡ï¼Œè§„èŒƒæ€§å’Œå¥å£®ç¨‹åº¦ã€‚

æˆ‘ä»¬å°†ä¼šä»åˆå§‹åŒ–ç¯å¢ƒå¼€å§‹ï¼Œç„¶åä»**æ£€æŸ¥ï¼ˆLintï¼‰** ã€**æµ‹è¯•ï¼ˆTestï¼‰** ã€**æ„å»ºï¼ˆBuildï¼‰** ã€**ç‰ˆæœ¬ç®¡ç†ï¼ˆVersion Controlï¼‰** å’Œ **æŒç»­åŒ–é›†æˆï¼ˆContinuous integrationï¼‰** è¿™å‡ æ–¹é¢æ¥æ­å»ºæˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒã€‚

é‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬æ¥åˆå§‹åŒ–æˆ‘ä»¬çš„ç¯å¢ƒã€‚

## åˆå§‹åŒ–ç¯å¢ƒ

é¦–å…ˆåœ¨ä»»æ„ä½ç½®æ–°å»ºä¸€ä¸ªåå« sparrow çš„æ–‡ä»¶å¤¹ï¼Œç„¶åå®‰è£…ä¸‹é¢å¯¹åº”ç‰ˆæœ¬çš„ [node](http://nodejs.cn/) å’Œ [npm](https://www.npmjs.com/)ï¼š

- node: 14.17.6

+ npm: 6.14.15

æ¥ä¸‹æ¥è¿è¡Œ `npm init \-y` æ¥åˆå§‹åŒ–ç¯å¢ƒï¼Œè¿™ä¹‹å sparrow æ–‡ä»¶å¤¹é‡Œä¼šå‡ºç°ä¸€ä¸ª `package.json` æ–‡ä»¶ã€‚åˆäº†å®ƒä¹‹åï¼Œæˆ‘ä»¬å°±æ¥æ­å»ºæˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒï¼

> ä»£ç ç¼–è¾‘å™¨æ¨èä½¿ç”¨ VSCode

## ä»£ç æ£€æŸ¥ï¼ˆLintï¼‰

é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç æ£€æŸ¥ï¼Œä»£ç æ£€æŸ¥æ˜¯ä¸€ç§é™æ€çš„åˆ†æï¼Œå¸¸ç”¨äºå¯»æ‰¾æœ‰é—®é¢˜çš„æ¨¡å¼æˆ–è€…ä»£ç ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬è§„èŒƒä»£ç å’ŒåŠ å°‘å‡ºé”™çš„å¯èƒ½æ€§ã€‚è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ **[ESlint](http://eslint.cn/docs/user-guide/getting-started)** æ¥ä½œä¸ºä»£ç æ£€æŸ¥çš„å·¥å…·ã€‚

```
$ npm install eslint --save-dev
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥åˆå§‹åŒ– ESlint çš„é…ç½®ï¼Œå®ƒä¼šé—®ä½ ä¸€äº›é—®é¢˜ï¼Œæ ¹æ®ä½ çš„é€‰æ‹©å»ç”Ÿæˆå¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚

```
$ npx eslint --init
```

è¿™é‡ŒæŠŠé—®é¢˜å’Œç­”æ¡ˆéƒ½è®°å½•ä¸‹æ¥äº†ã€‚

- How would you like to use ESLint\? > _To check syntax, find problems, and enforce code style_

+ What type of modules does your project use\? > _JavaScript modules \(import/export\)_

+ Which framework does your project use\? > _None of these_

+ Does your project use TypeScript\? > _NO_

+ Where does your code run\? > _Browser, Node_

+ How would you like to define a style for your project > _Use a popular style guide_

+ Which style guide do you want to follow\? > _Airbnb: <https://github.com/airbnb/javascript>_

+ What format do you want your config file to be in\? > _JavaScript_

+ Would you like to install them now with npm\? > _Yes_

æœ€åå¯¹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶è¿›è¡Œç®€å•ä¿®æ”¹åå¦‚ä¸‹ï¼š

```js
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true,
    // è¿™é‡Œå¢åŠ ä¸€è¡Œï¼Œç”¨äºæ”¯æŒåé¢çš„æµ‹è¯•ç¯å¢ƒ
    jest: true,
  },
  extends: ["airbnb-base"],
  parserOptions: {
    ecmaVersion: 13,
    sourceType: "module",
  },
  rules: {
    // è¿™é‡Œæ·»åŠ ä¸€è¡Œè§„åˆ™æŠŠè¿™æ¡è§„åˆ™éšè—
    "import/prefer-default-export": 0,
  },
};
```

å› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ airbnb çš„è§„åˆ™é›†åˆï¼Œæ‰€ä»¥éœ€è¦é¢å¤–å®‰è£…ä¸‹é¢çš„åŒ…ï¼š

```
$ npm install eslint-plugin-import eslint-config-airbnb-base@latest --save-dev
```

ä¸ºäº†éªŒè¯ eslint å·²ç»æ­£ç¡®ä½¿ç”¨äº†ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹å¢åŠ ï¼š`src/index.js` å’Œ `src/drawRedRect.js`ï¼Œå¹¶ä¸”è¾“å…¥ä»¥ä¸‹çš„ä»£ç ï¼š

```js
// src/index.js

export { drawRedRect } from './drawRedRect';
```

```js
// src/drawRedRect.js

export function drawRedRect(svg) {
  var rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect')
  rect.setAttribute('x', 0)
  rect.setAttribute('y', 0)
  rect.setAttribute('fill', 'red')
  rect.setAttribute('width', 100)
  rect.setAttribute('height', 100)
  svg.appendChild(rect)
}
```

åœ¨æ§åˆ¶å°è¾“å…¥å‘½ä»¤ï¼š`npx eslint src/drawRedRect.js` ä¼šå»æ£€æµ‹ `src/drawRedRect.js` æ–‡ä»¶å­˜åœ¨çš„è§„åˆ™é—®é¢˜ï¼Œå¦‚æœåŠ ä¸Š `--fix` é€‰é¡¹ä¼šä¿®å¤åœ¨[è§„åˆ™åˆ—è¡¨](https://eslint.bootcss.com/docs/rules/)æœ‰é»„è‰² ğŸ”§ æ ‡è®°çš„è§„åˆ™ã€‚è¿™é‡Œæˆ‘ä»¬è¾“å…¥ `npx eslint src/drawRedRect.js \--fix`ï¼Œè¿™ä¸ªæ—¶å€™æ‰“å¼€ `src/drawRedRect`ï¼Œä¼šå‘ç° `var` è¢«ä¿®å¤æˆäº† `const`ï¼Œå¹¶ä¸”æ¯ä¸€æ¡è¯­å¥æœ«å°¾éƒ½è¢«æ·»åŠ ä¸Šäº† `;`ã€‚

```js
// src/drawRedRect.js

export function drawRedRect(svg) {
  const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
  rect.setAttribute('x', 0);
  rect.setAttribute('y', 0);
  rect.setAttribute('fill', 'red');
  rect.setAttribute('width', 100);
  rect.setAttribute('height', 100);
  svg.appendChild(rect);
}
```

è¿™ä¹‹åæˆ‘ä»¬ç»™ `package.json` å¢åŠ  `lint` å‘½ä»¤å¦‚ä¸‹ï¼š

```json
{
  "scripts": {
    "lint": "eslint --fix"
  }
}
```

ä¸ºäº†æ›´å¥½çš„å¼€å‘ä½“éªŒï¼Œå¦‚æœä½¿ç”¨ VSCode è¯å¯ä»¥å®‰è£… eslint æ’ä»¶ï¼ˆç›´æ¥åœ¨åº”ç”¨å•†åº—æœç´¢å³å¯ï¼‰ã€‚ä¸€æ–¹é¢æ’ä»¶ä¼šç›´æ¥åœ¨æ–‡ä»¶ä¸­æŠŠé—®é¢˜é«˜äº®å‡ºæ¥ï¼Œå¦ä¸€æ–¹é¢æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤æ¥ç›´æ¥ä¿®å¤é—®é¢˜ï¼š`cmd + p` + `> ESlint: Fix all auto-fixable Problems`ã€‚æ›´å¤š [ESlint](http://eslint.cn/docs/user-guide/getting-started) ç›¸å…³çš„ä¸œè¥¿å¯ä»¥å»å®˜ç½‘å­¦ä¹ ã€‚

## ä»£ç æµ‹è¯•ï¼ˆTestï¼‰

ä»£ç æ£€æµ‹ä¹‹åå°±æ˜¯ä»£ç æµ‹è¯•äº†ï¼Œä¼˜ç§€çš„å•å…ƒæµ‹è¯•èƒ½ä¿è¯æˆ‘ä»¬çš„é¡¹ç›®åœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­ä¸å‡ºé—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ **[Jest](https://www.jestjs.cn/)** å’Œ **[Jest Electron](https://github.com/hustcc/jest-electron)** æ¥æ­å»ºæˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒã€‚

Jest æ˜¯ä¸€ä¸ªæµè¡Œçš„ JavaScript çš„æµ‹è¯•æ¡†æ¶ï¼Œä¸€èˆ¬éƒ½è¿è¡Œåœ¨ node æˆ–è€…æ¨¡æ‹Ÿå‡ºæ¥çš„æµè§ˆå™¨ç¯å¢ƒï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬å¼€å‘çš„æ˜¯ä¸€ä¸ªå›¾è¡¨åº“ï¼ŒçœŸå®çš„æµè§ˆå™¨ç¯å¢ƒä¼šæ›´åŠ æ˜“äºæˆ‘ä»¬è°ƒè¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ Jest Electronã€‚æˆ‘ä»¬ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸€å®šè¦å®‰è£…ä¸‹é¢ç‰ˆæœ¬çš„ Jestï¼Œå¦è€…ä¼šå‡ºé—®é¢˜ã€‚

```
$ npm i jest@26.0.1 jest-electron --save-dev
```

ç„¶åå¢åŠ ä¸€ä¸ªåå« `jest.config.js` å¹¶ä¸”å¢åŠ å†…å®¹å¦‚ä¸‹ï¼š

```js
module.exports = {
  testMatch: ['**/__tests__/**/*.spec.js'], // åªæµ‹è¯•åç¼€ä¸º .spec.js çš„æ–‡ä»¶
  runner: 'jest-electron/runner', // æŒ‡å®šæµ‹è¯•çš„ runner
  testEnvironment: 'jest-electron/environment', //  åˆ¶å®šæµ‹è¯•çš„ç¯å¢ƒ
};
```

åœ¨çœŸæ­£å¼€å§‹æµ‹è¯•ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦å°†ä»£ç ç¼–è¯‘æˆå¯ä»¥åœ¨ node ç¯å¢ƒä¸‹é¢å¯ä»¥è¿è¡Œçš„ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ **[Babel](https://babel.docschina.org/)** äº†ã€‚Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨ï¼Œä¸»è¦ç”¨äºåœ¨å½“å‰å’Œæ—§çš„æµè§ˆå™¨æˆ–ç¯å¢ƒä¸­ï¼Œå°† ECMAScript 2015+ ä»£ç è½¬æ¢ä¸º JavaScript å‘åå…¼å®¹ç‰ˆæœ¬çš„ä»£ç ã€‚

```
$ npm install --save-dev @babel/core @babel/cli @babel/preset-env
```

ç„¶åå¢åŠ ä¸€ä¸ªåå« `.babelrc` çš„æ–‡ä»¶å¹¶ä¸”è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```json
{
  "presets": [
    [
      "@babel/preset-env",
      {
        "useBuiltIns": "entry",
        "corejs": "3.6.4"
      }
    ]
  ],
  "exclude": "node_modules/**"
}
```

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹å¢åŠ  `__tests__` æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å¢åŠ  `index.spec.js` å’Œ `utils.js` æ–‡ä»¶:

```js
// __tests__/index.spec.js

import { drawRedRect } from '../src';

describe('test', () => {
  test('drawRedRect()', () => {
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', 400);
    svg.setAttribute('height', 400);
    svg.setAttribute('viewBox', [0, 0, 400, 400]);
    document.body.appendChild(svg);
    
    drawRedRect(svg);
    expect(svg.getElementsByTagName('rect').length).toBe(1);
  });

});
```

```js
// __tests__/utils.js

export function createDiv() {
  const div = document.createElement('div');
  document.body.appendChild(div);
  return div;
}
```

å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯æˆ‘ä»¬è¿è¡Œï¼š`npx jest` å’Œæ™®é€šçš„æµ‹è¯•æµ‹è¯•æ²¡æœ‰å¤ªå¤šçš„åŒºåˆ«ï¼Œä½†æ˜¯ `DEBUG_MODE=1 npx jest` ä¼šé¢å¤–æ‰“å¼€ä¸€ä¸ªåŸºäº Electron çœŸå®çš„æµè§ˆå™¨ï¼Œå¹¶ä¸”è¾“å‡ºå¦‚ä¸‹ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/037eed6c95114c4d83f61b6dc736b4f1~tplv-k3u1fbpfcp-zoom-1.image)

ä¸ºäº†å…¼å®¹ Windows å’Œ Mac ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–å®‰è£…ä¸€ä¸ª cross-env è¿™ä¸ªåº“ã€‚

```bash
$ npm install --save-dev cross-env
```

è¿™æ ·éœ€è¦æ‰“å¼€ Electron æµ‹è¯•çš„æ—¶å€™è¾“å…¥ï¼š`cross-env DEBUG_MODE=1 npx jest`ã€‚

è¿™ä¸ªè¿‡ç¨‹ä¸­ Jest ä¼šé¦–å…ˆè¯»å– `.babelrc` çš„å†…å®¹ï¼Œç”¨ Babel å°†ä»£ç ç¼–è¯‘ä¹‹åå†æµ‹è¯•ã€‚ä¹‹åæˆ‘ä»¬ç»™ `package.json` å¢åŠ  `test` å’Œ `test-live` å‘½ä»¤å¦‚ä¸‹ï¼š

```json
{
  "scripts": {
    "test": "jest --coverage",
    "test-live":"cross-env DEBUG_MODE=1 jest --coverage",
  }
}
```

## ä»£ç æ„å»ºï¼ˆBuildï¼‰

å› ä¸ºæˆ‘ä»¬æœ€åæ˜¯å®Œæˆä¸€ä¸ªåº“å¹¶ä¸”å‘å¸ƒåœ¨ npm ä¸Šä¾›å¤§å®¶ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œæ„å»ºï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹ç¼–è¯‘å¥½çš„ä»£ç è¿›è¡Œæ‰“åŒ…: å°†å°å—ä»£ç ç¼–è¯‘æˆå¤§å—å¤æ‚çš„ä»£ç ï¼Œç„¶ååœ¨ä¸åŒçš„ç¯å¢ƒä¸‹è¿è¡Œã€‚è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬é€‰æ‹© [Rollup](https://www.rollupjs.com/) æ¥ä½œä¸ºæˆ‘ä»¬çš„æ‰“åŒ…å™¨ã€‚

åœ¨æ‰“åŒ…ä¹‹å‰æˆ‘ä»¬éœ€è¦ Rollup ç”¨ Babel å¯¹ä»£ç è¿›è¡Œç¼–è¯‘ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å®‰è£… `rollup-plugin-babel` è¿™ä¸ªæ’ä»¶ã€‚

```
$ npm install --save-dev rollup rollup-plugin-babel
```

å¦ä¸€æ–¹é¢æˆ‘ä»¬è¿˜éœ€è¦ `rollup-plugin-node-resolve` è¿™ä¸ªæ’ä»¶æ¥ä¿è¯æ‰“åŒ…è¿‡ç¨‹èƒ½æ­£ç¡®åŠ è½½æ–‡ä»¶ã€‚

```
$ npm install --save-dev rollup-plugin-node-resolve
```

å®‰è£…å®Œæˆä¹‹åæˆ‘ä»¬æ–°å»º `rollup.config.js` æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹çš„å†…å®¹ï¼š

```js
import babel from 'rollup-plugin-babel';
import resolve from 'rollup-plugin-node-resolve';

export default {
  input: 'src/index.js', // æ‰“åŒ…å…¥å£
  output: [
    {
      file: 'lib/sparrow.js', // å¯¹äº Nodejsï¼Œæ‰“åŒ…æˆ commonjs
      format: 'cjs',
    },
    {
      file: 'esm/sparrow.js', // å¯¹äºæµè§ˆå™¨ï¼Œæ‰“åŒ…æˆ ES module
      format: 'es',
    },
    {
      file: 'dist/sparrow.min.js',
      name: 'sp',
      format: 'umd', // å¯¹äº Nodejs å’Œæµè§ˆå™¨ï¼Œæ‰“åŒ…æˆæ··åˆæ¨¡å¼
    },
  ],
  plugins: [
    resolve(),
    babel(), // ä½¿ç”¨ babel æ’ä»¶
  ],
};
```

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿è¡Œ `npx rollup \--config` å°±å¯ä»¥å‘ç°ç›®å½•ä¸­å¤šäº†ä¸‰ä¸ª `dist`ã€`esm` å’Œ `lib` æ–‡ä»¶å¤¹å°±æ˜¯æˆ‘ä»¬çš„æ‰“åŒ…ç»“æœã€‚å½“ç„¶è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸€ä¸ªå°å·¥å…· [rimraf](https://github.com/isaacs/rimraf)ï¼Œåœ¨æ¯æ¬¡æ‰“åŒ…ä¹‹å‰æŠŠä»¥å¾€çš„æ‰“åŒ…ä»£ç åˆ é™¤ã€‚

```
$ npm i rimraf --save-dev
```

ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼š`npx rimraf \-rf ./dist ./lib ./esm` å°±å¯ä»¥æŠŠä¹‹å‰ç”Ÿæˆçš„æ–‡ä»¶åˆ é™¤äº†ã€‚ä¹‹åæˆ‘ä»¬ç»™ `package.json` å¢åŠ  `build` å‘½ä»¤å¦‚ä¸‹ï¼š

```js
{
  "scripts": {
    "build": "rimraf -rf ./dist ./lib ./esm && rollup --config"
  }
}
```

## ç‰ˆæœ¬ç®¡ç†ï¼ˆVCï¼‰

æ¥ä¸‹æ¥çœ‹çœ‹æˆ‘ä»¬çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œè¿™é‡Œå½“ç„¶ä½¿ç”¨ [Git](https://git-scm.com/)ã€‚æˆ‘ä»¬é¦–å…ˆè¿è¡Œ `git init`ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªå¦‚ä¸‹çš„ `.gitignore` æ–‡ä»¶æ¥æŒ‡å®šä¸åŠ å…¥ç‰ˆæœ¬ç®¡ç†çš„æ–‡ä»¶ã€‚

```
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Sys
.DS_Store

# Node
node_modules/

# Build
dist
lib
esm

# Test
coverage
```

å¾€å¾€åœ¨ä½¿ç”¨ Git æäº¤ï¼ˆCommitï¼‰ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å¸Œæœ›å…ˆå¯¹æ–°åŠ å…¥æš‚å­˜åŒºä»£ç è¿›è¡Œä¸€ä¸‹æ£€æŸ¥ï¼Œå¹¶ä¸”è§„èŒƒæäº¤ä¿¡æ¯ï¼ˆCommit Messageï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸‰ä¸ªå·¥å…·ï¼š

- [husky](https://typicode.github.io/husky/#/)ï¼š husky èƒ½è®©ä½ åˆ›å»ºå‹¾å­ï¼ˆHookï¼‰ï¼Œè¿™äº›é’©å­ä¼šåœ¨æŒ‡å®šæ—¶å€™æ‰§è¡Œã€‚

+ [commitlint](https://commitlint.js.org/#/)ï¼šcommitlint ä¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™å¯¹ä½ çš„æäº¤ä¿¡æ¯è¿›è¡Œæ£€æŸ¥ã€‚

+ [lint-staged](https://github.com/okonet/lint-staged)ï¼šlint-staged åªä¼šå¯¹ä½ çš„æ–°åŠ å…¥æš‚å­˜åŒºçš„æ–‡ä»¶è¿›è¡ŒæŒ‡å®šçš„æ“ä½œã€‚

æˆ‘ä»¬é¦–å…ˆå®‰è£… huskyï¼š

```
$ npx husky-init && npm install
```

ç„¶ååˆå§‹åŒ–ä¸¤ä¸ªé’©å­ï¼špre-commitï¼ˆåœ¨æäº¤å‰æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼‰å’Œ commit-msgï¼ˆåœ¨æäº¤çš„æ—¶å€™æ‰§è¡Œåé¢çš„å‘½ä»¤ï¼‰ï¼š

```
$ npx husky add .husky/pre-commit 'npx lint-staged'
```

```
$ npx husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'
```

ç„¶åæˆ‘ä»¬æ¥å®‰è£…ä¸Šé¢æåˆ°çš„ lint-stagedï¼Œå¹¶ä¸”ä¿®æ”¹ `package.json` å¦‚ä¸‹ï¼š

```
$ npx mrm@2 lint-staged --save-dev
```

```js
{
  "lint-staged": {
    "*.js": ["eslint --fix"] // åœ¨æäº¤å‰ç”¨ eslint ä¿®å¤æ‰€æœ‰ js æ–‡ä»¶
  }
}
```

æœ€åå®‰è£… commitlint å¹¶ä¸”ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š

```bash
# Mac ç­‰ç³»ç»Ÿ
$ npm install --save-dev @commitlint/{cli,config-conventional}

# Windows ç³»ç»Ÿ
$ npm install --save-dev @commitlint/config-conventional @commitlint/cli
```

```
$ echo "module.exports = { extends: ['@commitlint/config-conventional'] };" > commitlint.config.js
```

ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨çš„ `config-conventional` è¿™ä¸ªè§„åˆ™ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://github.com/conventional-changelog/commitlint/tree/master/@commitlint/config-conventional)ã€‚

è¿™ä¹‹åæˆ‘ä»¬æ¥æäº¤ç¬¬ä¸€æ¬¡æäº¤ä»£ç ï¼š`git add . && git commit \-m "chore: init local env"`ï¼Œä¸€åˆ‡æ­£å¸¸çš„è¯æ§åˆ¶å°è¾“å‡ºå›¾å¦‚ä¸‹ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d28a7a789ec6474081578caacfc8b41a~tplv-k3u1fbpfcp-zoom-1.image)

## æŒç»­åŒ–é›†æˆï¼ˆCIï¼‰

æœ€åæ¥åˆ°æˆ‘ä»¬çš„æŒç»­åŒ–é›†æˆï¼ˆCIï¼‰ï¼šé¢‘ç¹åœ°ï¼ˆä¸€å¤©å¤šæ¬¡ï¼‰å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ã€‚æŒç»­é›†æˆçš„ç›®çš„ï¼Œå°±æ˜¯è®©äº§å“å¯ä»¥å¿«é€Ÿè¿­ä»£ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒé«˜è´¨é‡ã€‚å®ƒçš„æ ¸å¿ƒæªæ–½æ˜¯ï¼Œä»£ç é›†æˆåˆ°ä¸»å¹²ä¹‹å‰ï¼Œå¿…é¡»é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚åªè¦æœ‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼Œå°±ä¸èƒ½é›†æˆã€‚æ›´å¤š CI çš„æ¦‚å¿µå¯ä»¥å‚è€ƒé˜®ä¸€å³°è€å¸ˆçš„[è¿™ç¯‡æ–‡ç« ](https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html)ã€‚

æ‰€ä»¥æˆ‘å¸Œæœ›æ¯æ¬¡æˆ‘ä»¬ push ä»£ç ï¼Œæˆ–è€…æäº¤ PRï¼ˆPull Requestï¼‰çš„æ—¶å€™éƒ½å¯¹ä»£ç è¿›è¡Œæ£€æµ‹ï¼ˆLintï¼‰ï¼Œæµ‹è¯•ï¼ˆTestï¼‰å’Œæ„å»ºï¼ˆBuildï¼‰ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªä¸æˆåŠŸå°±æ˜¾ç¤ºå¤±è´¥ã€‚

é¦–å…ˆæˆ‘ä»¬éœ€è¦ [npm-run-all](https://www.npmjs.com/package/npm-run-all) æ¥é¡ºåºæˆ–è€…å¹¶è¡Œæ‰§è¡Œå¤šä¸ª npm è„šæœ¬å‘½ä»¤ï¼š

```
$ npm install npm-run-all --save-dev
```

ç„¶ååœ¨ `package.json` é‡Œé¢æ·»åŠ å¯¹åº”çš„ CI å‘½ä»¤ï¼Œ`run-s` æ˜¯æŒ‡é¡ºåºæ‰§è¡Œï¼š

```json
{
   "scripts": {
      "ci": "run-s lint test build"
  }
}
```

ç„¶åæˆ‘ä»¬ä½¿ç”¨ Github Action æ¥å®ŒæˆæŒç»­åŒ–é›†æˆã€‚Actionï¼ˆåŠ¨ä½œï¼‰æ˜¯æŒ‡æŒç»­åŒ–é›†æˆçš„æ“ä½œï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„æµ‹è¯•ã€æ„å»ºå’Œæ£€æµ‹ç­‰ç­‰ã€‚Github éœ€è¦é…ç½®æ–‡ä»¶æ¥çŸ¥é“ CI çš„æµç¨‹ã€‚

æˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª `.github` çš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢æ–°å»ºä¸€ä¸ªåå« `workflows` çš„æ–‡ä»¶å¤¹ï¼Œæœ€åæ–°å»ºä¸€ä¸ª `ci.yml` çš„æ–‡ä»¶å¹¶ä¸”è¾“å…¥ä»¥ä¸‹çš„å†…å®¹ã€‚

```yaml
name: ci

on: [push, pull_request]

jobs:
  build:
    runs-on: macOS-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4
        
      - name: Setup Node.js environment
        uses: actions/setup-node@v2.1.5
        with:
          node-version: "12"
          
      - name: Cache node modules
        uses: actions/cache@v2
        env:
          cache-name: cache-node-modules
        with:
          path: ./node_modules
          key: ${{ runner.os }}-build-cache-node-modules-${{ hashFiles('**/package.json') }}
          restore-keys: |
            cache-node-modules-

      - name: Run ci
        run: |
          npm install
          npm run ci
```

ä¸Šé¢æœ‰å‡ ä¸ªåœ°æ–¹å¾ˆå…³é”®ï¼šé¦–å…ˆæ˜¯ `on: [push, pull_request]`ï¼Œè¯´æ˜æ˜¯åœ¨ push å’Œ pull\_request çš„æ—¶å€™ä¼šè§¦å‘å½“å‰çš„è¿™ä¸ªå·¥ä½œæµï¼ˆWorkflowï¼‰ï¼šæŒç»­é›†æˆä¸€æ¬¡è¿è¡Œçš„è¿‡ç¨‹ã€‚ç„¶åæ¯ä¸€ä¸ªå·¥ä½œæµåŒ…å«å¤šä¸ªæ­¥éª¤ï¼ˆStepï¼‰ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨æœ€åä¸€ä¸ªæ­¥éª¤ï¼š`Run ci`ã€‚å¯ä»¥å‘ç°è¿™ä¸ªæ­¥éª¤ä¸»è¦ç”±ä¸¤ä¸ªåŠ¨ä½œæ„æˆï¼š`npm install` ç”¨æ¥å®‰è£…ä¾èµ–ï¼Œ`npm run ci` æ¥çœŸæ­£æ‰§è¡Œæˆ‘ä»¬çš„ CI æµç¨‹ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨ Github ä¸Šæ–°å»ºä¸€ä¸ªåå« Sparrow çš„ä»“åº“ï¼Œå¹¶ä¸”å’Œæœ¬åœ°è¿™ä¸ªä»“åº“å…³è”èµ·æ¥ã€‚æ¥ä¸‹æ¥æäº¤ä»£ç å¹¶ä¸”æ¨åˆ°è¿œç¨‹ä»“åº“ï¼š

`git commit \-m "chore: add ci" && git push`

è¿™ä¸ªæ—¶å€™å°±ä¼šè‡ªåŠ¨è§¦å‘ CI äº†ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e04b1468a6149cd8ef7123a1513fe56~tplv-k3u1fbpfcp-zoom-1.image)

CI ç»“æŸä¹‹åå¦‚ä¸‹å°±è¯´æ˜æ²¡æœ‰é—®é¢˜äº†ï¼

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe3d455546274b1d99a9d98d52668b95~tplv-k3u1fbpfcp-zoom-1.image)

Github Action çš„æ·±å…¥å­¦ä¹ åŒæ ·å¯ä»¥å‚è€ƒé˜®ä¸€å³°è€å¸ˆçš„[å¦ä¸€ç¯‡æ–‡ç« ](http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html)ã€‚

## æ€»ç»“

ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒå°±æ­å»ºå®Œæˆäº†ï¼Œæ­¤åˆ»çš„ä»£ç å¯ä»¥åœ¨è¿™ä¸ª[åˆ†æ”¯](https://github.com/sparrow-vis/sparrow/tree/chore/env)æŸ¥çœ‹ã€‚æ€»ç»“ä¸€ä¸‹ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„å¼€å‘ç¯å¢ƒå¯ä»¥è®©æˆ‘ä»¬æœ‰ä»¥ä¸‹èƒ½åŠ›ï¼š

- ä»£ç æ£€æµ‹ï¼šæ¥ä¿è¯ä»£ç çš„é£æ ¼æ­£ç¡®
- ä»£ç æµ‹è¯•ï¼šä¿è¯ä»£ç çš„åŠŸèƒ½æ­£ç¡®
- ä»£ç æ„å»ºï¼šä¿è¯æˆ‘ä»¬çš„ä»£ç å¯ä»¥åœ¨ä¸åŒç¯å¢ƒé‡Œé¢è¿è¡Œ
- ç‰ˆæœ¬ç®¡ç†ï¼šä¿è¯ååŒå¼€å‘çš„ç»Ÿä¸€æ€§
- æŒç»­åŒ–é›†ï¼šæˆä¿è¯ä»£ç é«˜è´¨é‡å¿«é€Ÿè¿­ä»£

ä¸‹ä¸€ç« æˆ‘ä»¬å°†å¼€å‘ç”¨äº Sparrow çš„æ•°æ®æ¸²æŸ“æ¨¡å—ï¼šæ¸²æŸ“å™¨ï¼ˆRendererï¼‰ã€‚
    