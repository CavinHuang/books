
# æ„å»ºç¯‡ - ä»£ç å®¡æŸ¥å¡ç‚¹
---

## å‰è¨€

å‰é¢å·²ç»å°†æ„å»ºçš„æµç¨‹å®Œå…¨çš„æ­å»ºå®Œæ¯•ï¼Œé‚£ä¹ˆåœ¨æ„å»ºæµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ’å…¥äº†ä¸€ä¸ª**ä»£ç å®¡æŸ¥**çš„ç¯èŠ‚ï¼Œé™¤äº†æœ¬èº«çš„å„ç§è¯­è¨€ç‹¬æœ‰çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹å¤–ï¼Œå¯ä»¥é€‰æ‹© [Sonarqube](url) å¯¹æ‰€æœ‰çš„é¡¹ç›®åšä¸€ä¸ªåˆæ­¥çš„é™æ€ä»£ç æ£€æŸ¥ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2950dfa786e1473a8e6b1d45559e08bd~tplv-k3u1fbpfcp-watermark.image?)

## Sonarqube

#### ä¸ºä»€ä¹ˆé€‰æ‹© Sonarqube

ç¬¬ä¸€é¦–é€‰æ˜¯ç¤¾åŒºç‰ˆæ˜¯å…è´¹ä½¿ç”¨çš„ï¼Œå¹¶ä¸”ç¤¾åŒºç‰ˆæœ¬çš„åŠŸèƒ½å°±å·²ç»éå¸¸å¤šï¼ŒåŸºæœ¬æ»¡è¶³å¸¸ç”¨çš„åŠŸèƒ½ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/431e4c1aac6641a5bc81d2cc0acf71c1~tplv-k3u1fbpfcp-watermark.image?)

ç¬¬äºŒä¸ªå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ”¯æŒçš„è¯­è¨€éå¸¸å¤šï¼Œå·²ç»æ¶µç›–äº†æˆ‘ä»¬å¤§éƒ¨åˆ†å¸¸è§„çš„é¡¹ç›®å¼€å‘è¯­è¨€ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b746c09226240328fcfb06bad1f42ac~tplv-k3u1fbpfcp-watermark.image?)

#### å®‰è£…

åˆ†æå®Œä¸ºä»€ä¹ˆé€‰æ‹© Sonarqube ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å¼€å§‹å®‰è£… Sonarqube äº†ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©åœ¨ä¹‹å‰æ­å»ºçš„è™šæ‹Ÿæœºå»å®‰è£… sonarã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3ef9cfd40b74294abebb670e66de333~tplv-k3u1fbpfcp-watermark.image?)

1.  ä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…

`wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.1.0.47736.zip`

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d74d212f1204399a481cf0cc2112ed2~tplv-k3u1fbpfcp-watermark.image?)

 2.     æ–°å»ºä¸€ä¸ªç”¨æˆ·

```
groupadd sonar
useradd sonar -g sonar -p sonar
```

 3.     æ–°å»ºsonarqubeç›®å½•

```
mkdir -p /usr/local/sonarqube
chown  sonar:sonar /usr/local/sonarqube
```

 4.     è§£å‹è½¯ä»¶åŒ…åˆ°ç›®å½• /usr/local/sonarqube

```
su - sonar
unzip -d /usr/local/sonarqube  sonarqube-9.1.0.47736.zip
```

5.  å¯åŠ¨ sonar

`/usr/local/sonarqube/sonarqube-7.5/bin/linux-x86-64/sonar.sh start`

æµè§ˆå™¨æ‰“å¼€ <http://192.168.160.88:9000/> å³å¯ï¼Œåˆå§‹åŒ–çš„ç”¨æˆ·å¯†ç éƒ½æ˜¯ï¼š`admin`

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ee8273d7d1f43ac97ab31d3ef0c6108~tplv-k3u1fbpfcp-watermark.image?)

6.  å®‰è£…æ±‰åŒ–ç‰ˆæœ¬

emmï¼Œå…¨è‹±æ–‡çœ‹ç€ä¸å¯¹åŠ²ï¼Œè¿›å…¥ marketPlace æœæ±‰åŒ–çš„ packï¼Œ å®‰è£…é‡å¯å³å¯ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49a6ef400d15464785741557a45a0384~tplv-k3u1fbpfcp-watermark.image?)

#### æ³¨æ„ç‚¹

è‡³æ­¤ï¼Œsonar çš„å®‰è£…å·²ç»å®Œæˆï¼Œä¸‹é¢æœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼š

1.  æ–°ç‰ˆçš„ sonar jdk çš„ç¯å¢ƒè¦åœ¨ 11 ä»¥ä¸Šï¼Œå¦‚æœæ˜¯å…¨æ–°çš„ç³»ç»Ÿï¼Œè‡ªå¸¦çš„ jdk ç‰ˆæœ¬éƒ½å¾ˆä½ï¼Œéœ€è¦å‡çº§ã€‚å¦‚æœæ²¡æœ‰é€‰æ‹©æœ€æ–°ç‰ˆæœ¬çš„ sonarï¼Œé‚£ä¹ˆè¦çœ‹çœ‹å¯¹åº”ç‰ˆæœ¬çš„ jdk æ˜¯å¤šå°‘ï¼Œå®‰è£…å¯¹åº”çš„æ‰èƒ½æ­£å¸¸å¯åŠ¨ã€‚
2.  **æƒé™ä¸€å®šè¦é…ç½®å¥½**ï¼Œroot ç”¨æˆ·æ˜¯ä¸èƒ½å¯åŠ¨ sonar çš„ï¼Œæ‰€ä»¥æ’ä»¶çš„ sonar ç”¨æˆ·æƒé™è¦ç»™è¶³ã€‚
3.  è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ mysql å»æ›¿æ¢æ•°æ®åº“ï¼Œè¿™æ ·çš„ sonar ä»…ä»…ä½œäºæµ‹è¯•ä½¿ç”¨ï¼Œ**ç”Ÿäº§çš„ä½¿ç”¨çš„è¯ï¼Œéœ€è¦æ›¿æ¢æ•°æ®åº“ï¼Œä¸ç„¶åæœŸçš„å‡çº§ã€æ•°æ®è¿ç§»éƒ½ä¸èƒ½è¿›è¡Œ**ã€‚

## Sonar çš„ä½¿ç”¨

å‰é¢æˆ‘ä»¬å®‰è£…çš„æ˜¯ Sonar çš„æœåŠ¡ç«¯ï¼Œå¯¹å¼€å‘æ¥è¯´ï¼Œè¿˜éœ€è¦æ¥å…¥å¯¹åº”çš„å®¢æˆ·ç«¯ `sonar-scanner` æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚

#### åˆ›å»ºé¡¹ç›®

æŒ‰ç…§ä¸‹å›¾æ­¥éª¤æ‰§è¡Œï¼Œç›´åˆ°æ‹¿åˆ°å¯¹åº”é¡¹ç›®çš„ tokenã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b92a95940ac94c24b0c9c0961f964420~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3b67fd151424ef5b23109e96f52e006~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f5fb3445f624e04ab2e7ea062244bfb~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c0ac67874c04012a6fd6909dab54e27~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2a5618d949b4438b1f16e5b70958403~tplv-k3u1fbpfcp-watermark.image?)

#### sonarscanner

1.  ç‚¹å‡»ä¸‹è½½å¯¹åº”çš„ [scanner-cli å®‰è£…åŒ…](https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/)

è§£å‹å®Œæ¯•ä¹‹åï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤æ¥å£ï¼ˆæˆ‘æ˜¯ windows ç¯å¢ƒï¼Œå„ä½åŒå­¦å®‰è£…å¯¹åº”çš„ç¯å¢ƒå³å¯ï¼‰

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5133e3d60df48c99e5a2d828b141b4f~tplv-k3u1fbpfcp-watermark.image?)

2.  åˆ›å»º `sonar-project.properties`

åœ¨é¡¹ç›®æ ¹è·¯å¾„åˆ›å»ºä¸€ä¸ª `sonar-project.properties`ï¼Œé…ç½®å†…å®¹å¦‚ä¸‹ï¼š

```sh
# must be unique in a given SonarQube instance
sonar.projectKey=test-h5

sonar.login=6ff8c3e3a6b2114c3814a80140f858e44c0b201a

# --- optional properties ---
sonar.sources=.

# defaults to project key
sonar.projectName=test-h5

sonar.host.url=http://192.168.160.88:9000
```

é…ç½®å®Œæ¯•ä¹‹åï¼Œåœ¨æ ¹ç›®å½•è¿è¡Œ `sonar-scanner.bat`ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec32b825bf9d42ad8635a9cc703e35fc~tplv-k3u1fbpfcp-watermark.image?)

å¦‚ä¸Šæ‰§ä¸Šè¿°å‘½ä»¤è¡Œå®Œæ¯•ä¹‹åï¼Œå³å¯å¾—åˆ°å¦‚ä¸‹çš„ç»“æœï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæµ‹è¯•é¡¹ç›®çš„è´¨é‡éå¸¸å¥½ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè¿™æ˜¯ç†æƒ³çš„çŠ¶æ€ï¼Œç°å®ä¸­è‚¯å®šä¸å­˜åœ¨è¿™ç§æƒ…å†µã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/865207010b0749df86978c2fb1c494c2~tplv-k3u1fbpfcp-watermark.image?)

## å¼•å…¥æ„å»ºæµç¨‹

å¼•å…¥æ„å»ºæµç¨‹å°±éå¸¸ç®€å•äº†ï¼Œå¾—ç›Šæˆ‘ä»¬ä¸Šä¸€è½®å¯¹ Jenkins è„šæœ¬çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å¯¹åº”çš„æ‰“åŒ…æœºä¸Šé…ç½®å¥½ sonar-scannerï¼Œå†™å…¥å¯¹åº”çš„è„šæœ¬å³å¯ã€‚

åŒæ—¶ sonar è¿˜æä¾›äº† Jenkins çš„æ’ä»¶ï¼Œä»¥åŠç›´æ¥å¯¹æ¥ Gitlab çš„æ‹“å±•åŠŸèƒ½ï¼Œæƒ³è¦å°è¯•çš„åŒå­¦å¯ä»¥æ ¹æ®æ–‡æ¡£è‡ªå·±å°è¯•ä¸€ä¸‹ã€‚

## æœ¬ç« å°ç»“ä¸Šè¿°

æœ¬ç« æ˜¯ Sonarqube çš„ä¸€ä¸ªå¸¸è§„ä½¿ç”¨ã€‚

ä¸ªäººå»ºè®®ï¼Œé™¤äº†å¸¸è§„çš„ eslint ä¹‹å¤–ï¼Œè¿˜æ˜¯å¯ä»¥å°è¯•ä¸€ä¸‹ sonarï¼Œå®ƒé™¤äº†æä¾›ä»£ç æ£€æµ‹ä¹‹åï¼Œä¹Ÿå¯¹é¡¹ç›®ã€åˆ†æ”¯æ•´ä½“æœ‰ä¸ªç®¡ç†ã€å¯¹æ¯”çš„ä½œç”¨ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49f2d8920529465b894fa459fcafc14d~tplv-k3u1fbpfcp-watermark.image?)

åœ¨å¤šé¡¹ç›®ä»¥åŠè§„æ¨¡ç¨å¤§çš„å›¢é˜Ÿä¸­è¿˜æ˜¯éå¸¸æœ‰æ•ˆæœçš„ï¼ŒåŒæ—¶ sonar ä¹Ÿæä¾›äº† web apiï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ€åæµç¨‹æ‰“é€šä¸­ï¼Œå¯ä»¥å°è¯•å°† sonar é›†æˆåˆ° devops é¡¹ç›®ä¸­ã€‚

å¦‚æœä½ æœ‰ä»€ä¹ˆç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºï¼Œæˆ–è€…åŠ ç¾¤æ²Ÿé€šã€‚ ğŸ‘
    