
# ç›‘æ§ç¯‡ - çº¿ä¸ŠåŸ‹ç‚¹ã€é¢„è­¦
---

## å‰è¨€

åœ¨å®Œæ•´çš„å·¥ç¨‹åŒ–ä½“ç³»ä¸­ï¼Œçº¿ä¸Šé¢„è­¦æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä½†æ˜¯è‡ªå·±å…¨éƒ¨å¼€å‘çš„è¯ï¼Œæ˜¯éå¸¸è€—æ—¶ã€è€—åŠ›çš„ï¼Œç»¼åˆæˆæœ¬è€ƒè™‘çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€äº›ç¬¬ä¸‰æ–¹å¼€æºçš„ç³»ç»Ÿæ¥ååŠ©æˆ‘ä»¬ï¼Œç»¼åˆæ¥çœ‹ Sentry æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ã€‚

## Sentry

### ä¸ºä»€ä¹ˆä½¿ç”¨ Sentry

1.  æ”¯æŒçš„å¼€å‘æ¡†æ¶éå¸¸å¤šï¼ŒåŸºæœ¬æ¶µç›–äº†å¸‚é¢æµè¡Œçš„æ‰€æœ‰æ¡†æ¶

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4858bfc364df4d74956a65734e98b6e6~tplv-k3u1fbpfcp-watermark.image?)

2.  sentry æ”¯æŒæ‰‹åŠ¨ä¸è‡ªåŠ¨ä¸ŠæŠ¥ï¼Œå³å¯æ— ç—•ç›‘å¬é¡¹ç›®ä¸­çš„é”™è¯¯ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸ŠæŠ¥ä¸€äº›å†…å®¹ï¼Œåˆ†ææ•°æ®ã€‚

3.  Sentry æ”¯æŒç§æœ‰éƒ¨ç½²ï¼Œå¦‚æœæ˜¯å…¬å¸çš„é¡¹ç›®ï¼Œç§æœ‰åŒ–éƒ¨ç½²å¯ä»¥è‡ªå®šä¹‰æ›´å¤šçš„åŠŸèƒ½ã€‚

ç»¼ä¸Šä¸€äº›ä¼˜ç‚¹ï¼ŒSentry åœ¨å¯¹ä¸­å°å‹å…¬å¸æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªä¸å¯å¤šå¾—çš„è½¯ä»¶ã€‚

### å®‰è£… Sentry

Sentry çš„å®‰è£…éå¸¸ç®€å•ï¼Œæ”¯æŒ docker ç›´æ¥éƒ¨ç½²ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä¹‹å‰çš„æœåŠ¡å™¨ä¸­ç»§ç»­å®‰è£…ä¸€ä¸ªçš„ Sentryã€‚

 1.     å®‰è£… docker-compose

```
sudo yum install epel-release
sudo yum install -y python-pip
sudo pip install docker-compose
```

 2.     åˆ¶ä½œæœ¬åœ°æ•°æ®åº“å’Œsentryçš„ç›®å½•é…ç½®ï¼Œç”¨æ¥ç»‘å®šæŒ‚è½½

```
sudo mkdir -p data/{sentry,postgres}
```

 3.     ä¸‹è½½ Sentry é¡¹ç›®

```
git clone https://github.com/getsentry/onpremise.git
```

4.  æŒ‰ç…§å®˜ç½‘çš„ç›´æ¥å®‰è£…

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/746cf97ee9e243d5ab1dd6286a6ee052~tplv-k3u1fbpfcp-watermark.image?)

```
sudo SENTRY_IMAGE=us.gcr.io/sentryio/sentry:83b1380 ./install.sh
```

é¡ºåˆ©çš„è¯ï¼Œæ­¤æ—¶åº”è¯¥å·²ç»å®‰è£…æˆåŠŸäº†ï¼Œæ‰“å¼€ <http://192.168.160.88:9000/> æ—¢å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç•Œé¢ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/439e40f4246e43fc86af62b4141b810d~tplv-k3u1fbpfcp-watermark.image?)

### ä½¿ç”¨ Sentry

#### å¸¸è§„ä½¿ç”¨

1.  åˆ›å»º sentry é¡¹ç›®

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/13355659608c41e78b299fae4abfaf02~tplv-k3u1fbpfcp-watermark.image?)

2.  é…ç½®é¡¹ç›®

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9289707bfae45bea41281d52c57b006~tplv-k3u1fbpfcp-watermark.image?)

å®‰è£… sentry å®¢æˆ·ç«¯

```
yarn add @sentry/react @sentry/tracing
```

sentry æ³¨å…¥

```
import React from "react";
import ReactDOM from "react-dom";
import * as Sentry from "@sentry/react";
import { Integrations } from "@sentry/tracing";
import App from "./App";

Sentry.init({
  dsn: "",
  autoSessionTracking: true,
  integrations: [
    new Integrations.BrowserTracing(),
  ],

  // We recommend adjusting this value in production, or using tracesSampler
  // for finer control
  tracesSampleRate: 1.0,
});

ReactDOM.render(<App />, document.getElementById("root"));
```

3.  è·å– DSN

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7f739ebb4bd4677a86c46745b5d7fb0~tplv-k3u1fbpfcp-watermark.image?)

ç‚¹å‡» issue è¿›å…¥é¡¹ç›®ï¼Œé…ç½®é€‰æ‹© DSN é€‰é¡¹ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e172d15ef10e4b9eb0caa3d0e55769e8~tplv-k3u1fbpfcp-watermark.image?)

å¦‚æœä½ çš„ DSN ä¸ºç©ºçš„è¯

ä¿®æ”¹ Sentry çš„Â `config.yml`

```
###################
# System Settings #
###################

# If this file ever becomes compromised, it's important to regenerate your a new key
# Changing this value will result in all current sessions being invalidated.
# A new key can be generated with `$ sentry config generate-secret-key`
# system.secret-key: 'changeme'
system.url-prefix: 'http://my-sentry-host:9000'
```

ç„¶åé‡å¯ docker å³å¯

```
docker-compose build # Build the services again after updating
docker-compose up -d # Recreate the services
```

æ€•éº»çƒ¦çš„è¯ï¼Œè‡ªå·±ç»„è£…ä¸€ä¸ªä¹Ÿè¡Œï¼šæ ¼å¼æ˜¯ `http://å…¬é’¥@ip:port/projectidã€‚`

4.  è¿è¡Œé¡¹ç›®å¦‚æœå‡ºç°ä¸‹å›¾çš„è¯·æ±‚çš„è¯ï¼Œä»£è¡¨é…ç½®æ²¡é—®é¢˜äº†ï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cbbfba7f39549f0b6e45e3c7a4366b8~tplv-k3u1fbpfcp-watermark.image?)

æ¥ä¸‹æ¥å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»ä¸Šä¼ äº†ä¸€æ¡ Performance ä¿¡æ¯åœ¨ sentry é‡Œé¢ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/60beb5f6dafc4c7f9987e8000d348848~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬åœ¨å°è¯•åœ¨é¡¹ç›®ä¸­å†™ä¸€ä¸ª `console.log(dd)`ï¼Œç„¶åå¯ä»¥å‘ç°åœ¨ sentry é‡Œé¢å·²ç»åˆ›å»ºäº†ä¸€ä¸ª issue äº†ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67beb071d1a74c229d5653a2a14e4afa~tplv-k3u1fbpfcp-watermark.image?)

#### sourcemap

æ ¹æ®ä¸Šå›¾å¤§å®¶ä¹Ÿèƒ½çœ‹åˆ°ï¼ŒSentry èƒ½æ•è·åˆ°é”™è¯¯å †æ ˆï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ä¸­ä¸€èˆ¬éƒ½æ˜¯å¯¹ä»£ç åšä¸€ä¸ªå‹ç¼©æ··æ·†çš„ï¼Œæ‰€ä»¥åé¦ˆå‡ºæ¥çš„é—®é¢˜ä¸æ˜¯é‚£ä¹ˆç›´è§‚ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šä¼ å¯¹åº”çš„ Sourcemap åˆ° Sentry ä¸Šï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ç”¨åˆ° Sentry CLIã€‚

å› ä¸ºæˆ‘ä»¬çš„ devops æ˜¯å¤šé¡¹ç›®ï¼Œä¸é™äºè„šæ‰‹æ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ç”¨ Sentry CLI æ¥ä¸Šä¼ ï¼Œè€Œä¸å€ŸåŠ© Webpack çš„æ’ä»¶ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ Sentry çš„ Webpack æ’ä»¶ã€‚

ä¸Šä¼  sourcemap å…¶å®éº»çƒ¦ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ deploy ç¯å¢ƒï¼Œåœ¨é¡¹ç›®æ ¹è·¯å¾„åˆ›å»ºä¸€ä¸ª `.sentryclirc` æ–‡ä»¶ã€‚

```js
[defaults]
url=http://192.168.160.88:9000 
// å¦‚æœä½ çš„æ“ä½œéƒ½æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ token æŠ¥é”™ï¼Œä¸€èˆ¬éƒ½æ˜¯ sentry é»˜è®¤ä¸Šä¼ è·¯å¾„è¢«æŒ‡å‘ sentry.ioï¼Œéœ€è¦æ·»åŠ è¿™ä¸ªå¼ºåˆ¶æŒ‡å‘æœ¬åœ°çš„ sentry åœ°å€ã€‚

[auth]
â€‹\r\n[defaults]\r\nurl=http://192.168.160.88:9000
project=fe-bp-ops
org=sentry
token=bd688046f6fc432daa7e7ab0e237a73bf175367364d14fe295879683a6fd1770
```

å…¶ä¸­çš„ token è·å–çš„æ–¹å¼å¦‚ä¸‹å›¾ï¼Œ

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50841e10db4a4eb582d7011b273b4361~tplv-k3u1fbpfcp-watermark.image?)

ç„¶å shell æ‰§è¡Œ

```shell
npx sentry-cli releases -o sentry -p fe-bp-ops files dev@0.0.1 upload-sourcemaps ./dist'
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7bb77cbcf5b940138c7f0665942f46fc~tplv-k3u1fbpfcp-watermark.image?)

åˆ†åˆ«ä»£è¡¨ï¼Œ-o ç»„ç»‡åï¼Œ-p é¡¹ç›®åï¼Œfiles ç‰ˆæœ¬ï¼Œupload-sourcemaps è·¯å¾„å³å¯ã€‚æ‰§è¡Œå®Œæ¯•å³å¯åœ¨ Sentry ä¸Šçœ‹åˆ°å¯¹åº”é¡¹ç›®ä¸­å·²ç»å­˜åœ¨äº†å¯¹åº”ç‰ˆæœ¬çš„ sourcemapã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39535c70c8454e82affbcac475c84b02~tplv-k3u1fbpfcp-watermark.image?)

## æœ¬ç« å°ç»“

åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä½¿ç”¨ Sentry æ¥ä½œä¸ºé¡¹ç›®çš„çº¿ä¸Šé¢„è­¦ç³»ç»Ÿã€‚

Sentry çš„æ–°ç‰ˆæœ¬ä¹Ÿæ·»åŠ äº† Performance çš„åŠŸèƒ½ï¼Œå¯¹äºå‰ç«¯çš„ä¸€äº›é¡¹ç›®æœ‰ä¸€ä¸ªè‡ªå¸¦çš„æ€§èƒ½ç›‘æ§ï¼Œåšä¸€ä¸ªå¤§æ¦‚çš„å‚è€ƒè¿˜æ˜¯ä¸é”™çš„ï¼Œæ¯•ç«Ÿå…è´¹ã€çœåŠ›ã€‚

åŒæ—¶ Sentry ä¹Ÿæ”¯æŒè‡ªå®šä¹‰ä¸ŠæŠ¥ï¼Œå¦‚æœè‡ªå¸¦çš„æ€§èƒ½åˆ†æä¸æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†ä¸€äº›ç‹¬ç«‹çš„æ€§èƒ½æ•°æ®ä½œä¸ºé”™è¯¯ä¸ŠæŠ¥ï¼Œç„¶åè¿›è¡Œåˆ†æï¼Œæ¯•ç«Ÿå…è´¹ã€çœåŠ›ï¼Œä¸è¿‡å¹¶ä¸é€‚åˆåšä¸šåŠ¡åŸ‹ç‚¹ã€‚

ä½†æ˜¯ Sentry ä»…ä»…æ˜¯ä¸€ä¸ªé¢„è­¦å·¥å…·ï¼Œå¦‚æœæœ‰æ¡ä»¶ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„åšæ–‡ï¼Œåšä¸€å¥—[å…¨é¢çš„æ— ç—•åŸ‹ç‚¹ç³»ç»Ÿ](https://juejin.cn/post/6872398266642726926)ã€‚

å¦‚æœä½ æœ‰ä»€ä¹ˆç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºï¼Œæˆ–è€…åŠ ç¾¤æ²Ÿé€šã€‚ ğŸ‘
    