
# React åŸºç¡€ç¯‡ - å‰ç«¯ç•Œé¢å¼€å‘
---

## å‰è¨€

æœ¬ç« èŠ‚å¼€å§‹ï¼Œå°†è¿›å…¥å®¢æˆ·ç«¯çš„å¼€å‘ï¼Œæ¶‰åŠåˆ°çš„æœ‰ Web å‰ç«¯ç•Œé¢ã€CLIå·¥å…·ã€æ’ä»¶ç­‰ç­‰ã€‚

å®¢æˆ·ç«¯çš„å…·ä½“è¡¨ç°å½¢å¼å¹¶ä¸å”¯ä¸€ï¼Œæœ€ç»ˆç›®çš„éƒ½æ˜¯ä¸ºäº†æé«˜ç ”å‘æ•ˆç‡ä¸è´¨é‡ã€‚å°å†Œåªæ˜¯ä¸¾å‡ºäº†å¸¸è§çš„ä¸‰ç§è¿›è¡Œæ¼”ç¤ºè€Œå·²ã€‚

æœ¬ç« å°†ä¼šä»‹ç» Web ç›¸å…³ç•Œé¢çš„åŠŸèƒ½å¼€å‘ä¸ä¸€äº›å¿…è¦çš„å†…å®¹ã€‚

## æ­å»ºåŸºç¡€æ¡†æ¶

ç”±äºé¡¹ç›®éœ€è¦å¿«é€Ÿä¸Šæ‰‹ä»¥åŠä¸Šçº¿ï¼Œå¯¹äºæ ·å¼ã€å¸ƒå±€ã€è·¯ç”±ã€æƒé™ç­‰ç­‰ä¸€ç³»åˆ—çš„é€šç”¨æ€§å¾ˆå¼ºçš„åŸºç¡€æ¡†æ¶ï¼Œè‡ªç ”æ¯”è¾ƒèŠ±æ—¶é—´ï¼ŒæŠ•å…¥çš„å›æŠ¥ç‡ä¸é«˜ã€‚å¯¹äºå¤§éƒ¨åˆ†ä¸­å°å‹å›¢é˜Ÿï¼Œç›´æ¥é€‰æ‹©ç¬¬ä¸‰æ–¹æˆç†Ÿçš„ä¸­å°æ¡†æ¶ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œæ€§ä»·æ¯”æ¯”è¾ƒé«˜ï¼Œä¾‹å¦‚ ANT DESIGN PROã€Element Adminã€Iview Admin ç­‰ã€‚

æœ¬å°å†Œé‡‡ç”¨äº† UmiJS + ANT DESIGN PRO çš„æ¶æ„è¿›è¡Œç ”å‘ã€‚

> åŒå­¦ä»¬å¯ä»¥æ ¹æ®è‡ªå·±å›¢é˜Ÿæƒ…å†µé€‰æ‹©ç¬¬ä¸‰æ–¹æˆ–è€…è‡ªç ”ã€‚åªè¦å®ŒæˆåŠŸèƒ½ï¼Œå¼€å‘è¯­è¨€åªæ˜¯å®Œæˆåº¦çš„å·¥å…·ã€‚

### UmiJS æ˜¯ä»€ä¹ˆï¼Ÿ

[UmiJS](https://umijs.org/zh-CN)ï¼Œä¸­æ–‡å¯å‘éŸ³ä¸ºä¹Œç±³ï¼Œæ˜¯å¯æ‰©å±•çš„ä¼ä¸šçº§å‰ç«¯åº”ç”¨æ¡†æ¶ã€‚Umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼ŒåŒæ—¶æ”¯æŒé…ç½®å¼è·¯ç”±å’Œçº¦å®šå¼è·¯ç”±ï¼Œä¿è¯è·¯ç”±çš„åŠŸèƒ½å®Œå¤‡ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚ç„¶åé…ä»¥ç”Ÿå‘½å‘¨æœŸå®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ã€‚

### ANT DESIGN PRO æ˜¯ä»€ä¹ˆï¼Ÿ

[Ant Design Pro](https://pro.ant.design/) æ˜¯ä¸€ä¸ªä¼ä¸šçº§ä¸­åå°å‰ç«¯/è®¾è®¡è§£å†³æ–¹æ¡ˆï¼ŒåŸºäº Ant Design çš„è®¾è®¡è§„èŒƒå’ŒåŸºç¡€ç»„ä»¶çš„åŸºç¡€ä¸Šï¼Œæç‚¼å‡ºå…¸å‹æ¨¡æ¿/ä¸šåŠ¡ç»„ä»¶/é…å¥—è®¾è®¡èµ„æºï¼Œè¿›ä¸€æ­¥æå‡ä¼ä¸šçº§ä¸­åå°äº§å“è®¾è®¡ç ”å‘è¿‡ç¨‹ä¸­çš„ã€ç”¨æˆ·ã€å’Œã€è®¾è®¡è€…ã€çš„ä½“éªŒã€‚

### å¿«é€Ÿæ­å»ºåŸºç¡€æ¡†æ¶

å°å†Œå°†é‡‡ç”¨ UmiJS 3.0 + Ant Design Pro 4.0 æ¥æ„å»ºä¸€ä¸ªåŸºç¡€çš„æ¨¡æ¿ã€‚

```js
yarn create umi

 Select the boilerplate type (Use arrow keys)
â¯ ant-design-pro  - Create project with an layout-only ant-design-pro boilerplate, use together with umi block.
  app             - Create project with a simple boilerplate, support typescript.
  block           - Create a umi block.
  library         - Create a library with umi.
  plugin          - Create a umi plugin.
```

Ant Design Pro è„šæ‰‹æ¶å°†ä¼šè‡ªåŠ¨å®‰è£…ï¼Œå®‰è£…å®Œä¾èµ–ä¹‹åï¼Œä¸€ä¸ªåŸºç¡€æ¡†æ¶å°±å®Œæˆäº†ã€‚

### è‡ªå®šä¹‰æ¨¡å—

åœ¨å®ŒæˆåŸºç¡€æ¡†æ¶ä¹‹åï¼Œé€šç”¨å‹çš„æ¡†æ¶ä¸ºäº†å…¼å®¹å¤§éƒ¨åˆ†é¡¹ç›®éƒ½ä¼šèå…¥å¾ˆå¤š**é¢„è®¾çš„é…ç½®é¡¹æˆ–è€…åŠŸèƒ½**ï¼Œå¯¹äºæ¯ä¸ªå›¢é˜Ÿæ¥è¯´ï¼Œæœ‰äº›åŠŸèƒ½å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œæ‰€ä»¥éœ€è¦å¯¹åŸºç¡€æ¡†æ¶åšä¸€ä¸ªè‡ªå®šä¹‰ï¼Œå¢åˆ ä¸€äº›æ¨¡å—å®Œå–„åŠŸèƒ½ã€‚

#### åˆ é™¤å…¨çƒåŒ–

å¸¸è§„ï¼ŒAnt Design Pro çš„å›½é™…åŒ–åœ¨å¤§éƒ¨åˆ†å›¢é˜Ÿæ„ä¹‰ä¸å¤§ï¼Œæ‰€ä»¥å¯ä»¥å…ˆåˆ é™¤ï¼ŒåæœŸæœ‰éœ€æ±‚å†è¿›è¡Œæ·»åŠ ã€‚

å…ˆåˆ é™¤ \@umijs/plugin-locale æ’ä»¶ï¼Œå…¶æ¬¡åˆ é™¤é¡¹ç›®ä¸­æ‰€æœ‰ formatMessage ç›¸å…³çš„åŠ¨æ€ä»£ç ï¼Œç§»é™¤ i18n çš„ç›¸å…³æ–‡ä»¶ï¼Œä¿®æ”¹æˆæ­£å¸¸æ–‡æ¡ˆå³å¯ã€‚

> å¦‚æœä½ æ˜¯æŒ‰ç…§ä¸Šè¿°çš„æ¨¡æ¿ä¸‹æ¥ï¼Œå†åˆ é™¤ \@umijs/plugin-locale çš„é…ç½®ä¹‹åï¼Œé¡¹ç›®åº”è¯¥ä¼šæŠ¥é”™ï¼ŒæŒ‰ç…§æŠ¥é”™çš„æŒ‡ç¤ºä¿®æ­£å°±è¡Œã€‚å¹¶ä¸ä¼šé€ æˆå¾ˆå¤šéº»çƒ¦ã€‚

#### æ·»åŠ å¼€å‘ç¯å¢ƒ

å¸¸è§„å¼€å‘ç¯å¢ƒéƒ½éœ€è¦æœ‰ 3 å¥—ï¼Œåˆ†åˆ«æ˜¯ devï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼Œtestï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰ï¼Œprodï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ã€‚å¦‚æœèµ„æºå¯Œä½™çš„è¯ï¼Œå¯ä»¥æ·»åŠ  preï¼ˆé¢„å‘ç¯å¢ƒï¼‰ã€‚

Umi é€šè¿‡ç¯å¢ƒå˜é‡ UMI\_ENV å¯ä»¥åŒºåˆ†ä¸åŒç¯å¢ƒæ¥æŒ‡å®šé…ç½®ã€‚

```
// .umirc.js æˆ–è€… config/config.js
export default { a: 1, b: 2 };
// .umirc.local.js æˆ–è€… config/config.local.js å¼€å‘ç¯å¢ƒ
export default { c: 'local' };
// .umirc.test.js æˆ–è€… config/config.test.js
export default { b: 'cloud', c: 'cloud' };
```

> åœ¨é…ç½®å¤šç¯å¢ƒæ–‡ä»¶çš„æ—¶å€™ï¼Œåˆ‡è®° config.js ä¸€å®šè¦å­˜åœ¨ï¼Œä¸ç„¶ä¼šå¤±æ•ˆ

åŒæ—¶ä¿®æ”¹å‘½ä»¤å¯åŠ¨å‘½ä»¤

```
"start:dev": "cross-env REACT_APP_ENV=dev MOCK=none umi dev",
"build:test": "cross-env UMI_ENV=test umi build",
"build:prod": "cross-env UMI_ENV=prod umi build",
```

è¿™æ ·å³å¯åœ¨ä¸åŒçš„ç¯å¢ƒï¼Œè¿è¡Œä¸åŒçš„å‘½ä»¤ï¼Œç”Ÿæˆå¯¹åº”çš„ç‰ˆæœ¬ã€‚ä¸¾ä¸ªæ —å­ï¼Œæµ‹è¯•ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒçš„æ¥å£ä¸ä¸€è‡´ï¼Œæˆ–è€…æœ‰äº›åŠŸèƒ½æ˜¯éœ€è¦åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨ã€‚

> æ¯•ç«Ÿ UmiJS + Ant Design Pro ç»“åˆä¹‹åçš„åŸºç¡€æ¡†æ¶éå¸¸æˆç†Ÿï¼Œç®€å•åŠ ä¸€äº›åŠŸèƒ½å³å¯è¿›è¡Œä¸šåŠ¡å¼€å‘ï¼Œå¦‚æœéœ€è¦å®šåˆ¶çš„è¯ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚å†è¿›ä¸€æ­¥è¿›è¡Œå®šåˆ¶ã€‚

## å‰ç«¯ç•Œé¢è®¾è®¡

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fcae3d33981749eda6eb02063e98aad2~tplv-k3u1fbpfcp-watermark.image)

åœ¨å‰é¢æ‰€æœ‰çš„å†…å®¹è®¾è®¡ä¸å¤§çº²ä¸­ï¼Œç´§é æ–‡å­—æè¿°ä¸æ¶æ„å›¾ï¼Œå¯èƒ½åŒå­¦ä»¬å¯¹æ•´ä½“çš„æ¶æ„äº†è§£çš„è¿˜ä¸å¤Ÿæ¸…æ™°ï¼Œé‚£ä¹ˆå€ŸåŠ©è¿™ä¸ªå‰ç«¯çš„ç•Œé¢ï¼Œå†æ¬¡ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹æ•´ä¸ªé¡¹ç›®çš„åŠŸèƒ½æ¨¡å—ã€‚

#### å·¥ä½œå°

å±•ç¤ºå¿«æ·å…¥å£ä¸ä¸€äº›å¸¸ç”¨ä¿¡æ¯ï¼ŒåŸºæœ¬å¤§çš„ä¸­å°é¡¹ç›®éƒ½æœ‰ï¼Œä¸è¿‡å¤šå±•è¿°ã€‚

#### CICD

è¿™å—çš„å†…å®¹ä¸»è¦æ˜¯ GitLab çš„é¡¹ç›®ä¿¡æ¯ä»¥åŠ CICD ç›¸å…³çš„æ¨¡å—ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4314de7631c044f4ab4e05ee8782b842~tplv-k3u1fbpfcp-watermark.image)

1.  å¯¹ GitLab çš„é¡¹ç›®è¿›è¡Œä¸€äº›å¿…é¡»ä¿¡æ¯ç®¡ç†
2.  å¯¹ GitLab çš„é¡¹ç›®åˆ†æ”¯è¿›è¡Œç®¡ç†
3.  è§¦å‘æ„å»ºã€éƒ¨ç½²ã€å›æ»šç­‰ä¸€ç³»åˆ—æ“ä½œ

#### é¡¹ç›®ç®¡ç†

é¡¹ç›®ç®¡ç†ä¹‹å‰è®¾è®¡çš„æ—¶å€™ä¹Ÿè¢«ç®€åŒ–ï¼Œä½¿ç”¨å•æ¬¡æµç¨‹æ¥ç®¡ç†æ¯æ¬¡è¿­ä»£çš„é¡¹ç›®è¿›åº¦ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09e92213305048b7b0cdf592d0997aaf~tplv-k3u1fbpfcp-watermark.image)

1.  ç®¡ç†æµç¨‹çš„ç›¸å…³ä¿¡æ¯
2.  ä¸å¼€å‘çš„é¡¹ç›®åˆ†æ”¯è¿›è¡Œå…³è”ç»‘å®š

#### å…¶ä»–æ¨¡å—

ä¸ GitLab é«˜åº¦é‡åˆçš„æ¨¡å—ï¼Œä¾‹å¦‚ç”¨æˆ·è¿™ç§å°±ä¸éœ€è¦åœ¨æœ¬å‰ç«¯é‡å¤å¼€å‘äº†ï¼Œæ³¨å†Œå¯ä»¥ç›´æ¥é“¾è½¬åˆ° GitLab çš„æ³¨å†Œé¡µé¢å³å¯ï¼Œå…¶ä»–ä¾‹å¦‚ pipelineã€issueã€commit ç­‰ç­‰ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

## åŠŸèƒ½å¼€å‘

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f54deac0fb944be1b280625038563cbe~tplv-k3u1fbpfcp-watermark.image)

é¦–å…ˆï¼Œä¸€èµ·æ¥çœ‹ä¸‹åŸºç¡€æ¡†æ¶æ”¹é€ ä¹‹åçš„ç›®å½•ç»“æ„ã€‚

- `config/**` å…¨å±€å±æ€§çš„é…ç½®ï¼Œå¯¹ umi é…ç½®çš„æ‰©å±•ï¼Œä¾‹å¦‚è·¯ç”±ã€ä¸»é¢˜ã€ä»£ç†ã€æ„å»ºç­‰ç­‰ç›¸å…³çš„é…ç½®ï¼›
- `mock/**` æ¨¡æ‹Ÿæ¥å£æ•°æ®ï¼Œçœ‹è‡ªå·±å–èˆï¼›
- `public/**` å…¬å…±èµ„æºå­˜æ”¾ï¼›
- `src/assets/**` é™æ€èµ„æºå­˜æ”¾ï¼ˆæ— ç¼–è¯‘è¦æ±‚çš„èµ„æºï¼‰ï¼›
- `src/constants/**` å…¬å…±å¸¸é‡å­˜æ”¾ï¼›
- `src/locales/**` ~~æ— éœ€æ±‚å¯ç›´æ¥åˆ é™¤ï¼Œå¤šè¯­è¨€é…ç½®~~ï¼›
- `src/models/**` å¸ƒå±€ç»„ä»¶ä»£ç ï¼›
- `src/pages/**` å…·ä½“é¡µé¢ä»£ç ï¼›
- `src/services/**` è¯·æ±‚å±‚ä»£ç ï¼›
- `src/utils/**` é€šç”¨å·¥å…·ç±»ï¼›

ä»¥ä¸Šç›®å½•ï¼Œå¯ä»¥æ ¹æ®è‡ªèº«é¡¹ç›®éœ€æ±‚ä¸å›¢é˜Ÿè§„èŒƒè¿›è¡Œè°ƒæ•´ã€‚

### ç™»å½•ï¼ˆJWT å‰ç«¯ä½¿ç”¨ï¼‰

æ”¹é€  `utils/request` æ¨¡å—

```js
/**
 * å¼‚å¸¸å¤„ç†ç¨‹åº
 */
const errorHandler = (error: { response: Response }): Response => {
  const { response } = error;
  if (response && response.status) {
    const errorText = codeMessage[response.status] || response.statusText;
    const { status, url } = response;

    if (response.status === 401) {
      window.location.href = '/user/login';
    }
    notification.error({
      message: `è¯·æ±‚é”™è¯¯ ${status}: ${url}`,
      description: errorText,
    });
  } else if (!response) {
    notification.error({
      description: 'æ‚¨çš„ç½‘ç»œå‘ç”Ÿå¼‚å¸¸ï¼Œæ— æ³•è¿æ¥æœåŠ¡å™¨',
      message: 'ç½‘ç»œå¼‚å¸¸',
    });
  }
  return response;
};

/**
 * é…ç½®requestè¯·æ±‚æ—¶çš„é»˜è®¤å‚æ•°
 */
const request = extend({
  prefix: '/api',
  errorHandler, // é»˜è®¤é”™è¯¯å¤„ç†
  credentials: 'include', // é»˜è®¤è¯·æ±‚æ˜¯å¦å¸¦ä¸Šcookie
  headers: {
    authorization: localStorage.getItem('authorization'), // è¯»å–æœ¬åœ°ä¿å­˜çš„ authorization token
  },
});

export default request;
```

æ”¹é€  service æ¨¡å—

```js
import request from '@/utils/request';

export interface LoginParamsType {
  username: string;
  password: string;
  mobile: string;
  captcha: string;
}

export async function fakeAccountLogin(params: LoginParamsType) {
  return request('/user/getUserToken', {
    getResponse: true, // å¼€å¯å¯ä»¥æ‹¿åˆ°è¿”å› header å‚æ•°ï¼Œå°†å¯¹åº”çš„ authorization token å­˜å…¥æœ¬åœ°ä½¿ç”¨
    method: 'POST',
    data: { params },
  });
}
```

å¦‚ä¸Šï¼Œæ‹¿åˆ° response header é‡Œé¢çš„ tokenï¼Œåç»­å¯ä»¥æ­£å¸¸è¯·æ±‚æ¥å£ã€‚

#### ç”¨æˆ·åå¯†ç ç™»å½•

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e794c32d6d44a92a570a8683f5f2c35~tplv-k3u1fbpfcp-watermark.image)

è¿™ä¸€å—æ¯”è¾ƒç®€å•ï¼Œform è¡¨å•æäº¤åˆ°åç«¯ï¼Œä½¿ç”¨ä¸Šè¿° JWT çš„ service è¯·æ±‚æ¨¡å—å³å¯ã€‚

#### GitLab Application æˆæƒ

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db8812ca53ab454ca2bd1291115ee052~tplv-k3u1fbpfcp-watermark.image)

å…ˆæ·»åŠ ä¸€ä¸ª Iconï¼Œä¹‹å‰çš„ç« èŠ‚å·²ç»åšè¿‡äº†å®¢æˆ·ç«¯çš„æ¨¡æ‹Ÿæˆæƒï¼Œç°åœ¨å°±æ˜¯å¯¹æ¥æ¥å£çš„æ—¶å€™äº†ã€‚

å®¢æˆ·ç«¯ä»£ç 

```js
<a href='http://192.168.160.88:8888/oauth/authorize?client_id=CLIENT_ID&redirect_uri=http://127.0.0.1:7001/user/getTokenByApp&response_type=code' >
<GitlabOutlined className={styles.icon} />
</a>
```

æœåŠ¡ç«¯ä»£ç 

```js
 @Get("/getTokenByApp")
  public async getTokenByApplications({
    request: {
      query: { code },
    },
  }) {
    const { ctx, app } = this;
    // gitLab è·å– access_token
    const userToken = await ctx.service.user.getTokenByApplications({ code });

    // gitLab è·å–ç”¨æˆ·ä¿¡æ¯
    const userInfo = await ctx.service.user.getUserInfo({
      access_token: userToken.access_token,
    });

    // ç”¨æˆ·æ•°æ®æœ¬åœ°è½åº“
    ctx.service.user.saveUser({
      userInfo,
    });

    // å°†ç”¨æˆ·ä¿¡æ¯åŠ token ä½¿ç”¨ jwt æ³¨å†Œ
    const token = app.jwt.sign(
      {
        userToken,
        userInfo,
      },
      app.config.jwt.secret
    );

    ctx.set({ "Access-Control-Expose-Headers": "authorization" });
    ctx.set({ authorization: token }); // è®¾ç½® headers
    ctx.cookies.set('authorization', token, {
      maxAge: 1000 * 3600 * 24, // cookieå­˜å‚¨ä¸€å¤© è®¾ç½®è¿‡æœŸæ—¶é—´åå…³é—­æµè§ˆå™¨é‡æ–°æ‰“å¼€cookieè¿˜å­˜åœ¨
      httpOnly: true, // ä»…å…è®¸æœåŠ¡è·å–,ä¸å…è®¸jsè·å–
      domain: '.cookieboty.com' // è®¾ç½®cookieè·¨åŸŸ
    });
    ctx.redirect(`http://fe.cookieboty.com`);
  }
```

å› ä¸ºé‡‡ç”¨äº†é‡å®šå‘çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç›´æ¥å°† authorization ä¿¡æ¯å­˜å…¥ cookieï¼ŒåŒæ—¶è·å– JWT éªŒè¯çš„ä¸­é—´ä»¶è·å– authorization token çš„æ–¹æ³•ä¹Ÿè¦åŒæ—¶å…¼å®¹ cookie ä¸ header çš„æ–¹å¼ã€‚

> è¿™é‡Œæ¶‰åŠåˆ°è·¨åŸŸçš„çŸ¥è¯†ç‚¹ï¼Œæƒ³è¦äº†è§£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŸ¥æ‰¾èµ„æ–™ã€‚åŒæ—¶å¯¹å®‰å…¨æ€§çš„æ ¡éªŒå°±æ²¡é‚£ä¹ˆä¸¥æ ¼äº†ï¼Œå®é™…å¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œè®°å¾—è¦ä¿æŠ¤ä¸€äº›ç§æœ‰çš„ client ä¸ token ä¿¡æ¯ã€‚

### WebSocket

#### socket.io-client å®¢æˆ·ç«¯é…ç½®

```js
window.onload = function () {
  // init
  const socket = io('http://127.0.0.1:7001', {
    // å®é™…ä½¿ç”¨ä¸­å¯ä»¥åœ¨è¿™é‡Œä¼ é€’å‚æ•°
    query: {
      room: 'nsp',
      userId: `client_${Math.random()}`,
    },

    transports: ['websocket'],
  });

  socket.on('connect', () => {
    const id = socket.id;

    log('#connect,', id, socket);

    // ç›‘å¬è‡ªèº« id ä»¥å®ç° p2p é€šè®¯
    socket.on(id, (msg: any) => {
      log('#receive,', msg);
    });
  });

  // æ¥æ”¶åœ¨çº¿ç”¨æˆ·ä¿¡æ¯
  socket.on('online', (msg: any) => {
    log('#online,', msg);
  });

  // ç³»ç»Ÿäº‹ä»¶
  socket.on('disconnect', (msg: any) => {
    log('#disconnect', msg);
  });

  socket.on('disconnecting', () => {
    log('#disconnecting');
  });

  socket.on('error', () => {
    log('#error');
  });

  window.socket = socket;
};
```

å®¢æœç«¯é‡‡ç”¨ socket.io-client å»é“¾æ¥ websocketã€‚ä¸Šè¿°æ˜¯åŸºç¡€é“¾æ¥éƒ¨åˆ†ï¼Œå…·ä½“çš„å®ç°è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¼€å‘ã€‚

#### Nginx å¼€å¯ WS

ç”±äºä¹‹å‰å·²ç»å°†é¡¹ç›®ç”± ip åœ°å€æ”¹æˆç”¨ Nginx ä»£ç†ä½¿ç”¨åŸŸåè®¿é—®ï¼Œæ­¤æ—¶å¦‚æœæ²¡æœ‰å¯¹ Nginx è¿›è¡Œé…ç½®çš„è¯ï¼Œæ˜¯æ²¡åŠæ³•æ­£å¸¸ä½¿ç”¨ WS çš„åŠŸèƒ½ã€‚

ä¿®æ”¹ Nginx config é…ç½®å¦‚ä¸‹ï¼š

```nginx
server{
        listen       80; 
        server_name  devops.cookieboty.com;
        location  / {
            proxy_pass   http://127.0.0.1:7001;
        }
        location  /socket.io/ { ## é…ç½®å¼€å¯ socket.io
            proxy_pass   http://127.0.0.1:7001;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_http_version 1.1;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $host;
        }
    }
```

ä¿®æ”¹å®Œæ¯•é‡å¯å³å¯ã€‚

#### å…¶ä»–åŠŸèƒ½

å…¶ä»–çš„ä¾‹å¦‚å‘å¸ƒã€æ–°å»ºé¡¹ç›®ã€æ„å»ºç­‰ç­‰ä¸€äº›ç³»åˆ—çš„åŠŸèƒ½ï¼Œåœ¨ Node ç¯‡å·²ç»å†™ä¸€éƒ¨åˆ†æ¥å£ demo äº†å¹¶ä¸”æµ‹è¯•äº†ã€‚ç”±äºå‰ç«¯å¯¹æ¥æ²¡æœ‰å¤ªå¤§çš„éš¾åº¦ï¼Œå°±ä¸åœ¨è¿™é‡Œç‰¹åˆ«è¯´æ˜ï¼ŒåæœŸå¯ä»¥æ ¹æ®å¼€æ”¾çš„å‰ç«¯ä»£ç å‚è€ƒä¸€ä¸‹ã€‚

## æœ¬ç« å°ç»“

æœ¬ç« ä¸»è¦å†…å®¹æ˜¯ UmiJS + Ant Design Pro å¼€å‘çš„å‰ç«¯ç•Œé¢ï¼Œç†Ÿç»ƒçš„åŒå­¦å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯ï¼Œé€‰æ‹©ä¸åŒçš„æ¨¡æ¿ä¸è¯­è¨€ï¼Œå¼€å‘è‡ªå·±çš„ä¸“å±ç•Œé¢ã€‚

å¦‚æœä½ æœ‰ä»€ä¹ˆç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºï¼Œæˆ–è€…åŠ ç¾¤æ²Ÿé€šã€‚ ğŸ‘
    