
# æ„å»ºç¯‡ - Docker
---

## å‰è¨€

æœ¬ç« å¼€å§‹éƒ½æ˜¯å¯¹ä¹‹å‰çš„ DevOps æµç¨‹çš„è¿›ä¸€æ­¥å‡çº§ï¼Œæ‰€ä»¥å†…å®¹è·Ÿå‰ç«¯çš„å…³è”å·²ç»è¶Šæ¥è¶Šå°‘ï¼Œå¯èƒ½è¯»èµ·æ¥ä¼šæœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œå°½å¯èƒ½ç”¨æœ€ç®€å•çš„æ–¹å¼é˜è¿°ã€‚

## Docker

#### ä»€ä¹ˆæ˜¯ Docker

> Docker æ˜¯ä¸€ä¸ª[å¼€æº](https://baike.baidu.com/item/%E5%BC%80%E6%BA%90/20720669)çš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„[é•œåƒ](https://baike.baidu.com/item/%E9%95%9C%E5%83%8F/1574)ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Â [Linux](https://baike.baidu.com/item/Linux) æˆ– [Windows](https://baike.baidu.com/item/Windows/165458)Â æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°[è™šæ‹ŸåŒ–](https://baike.baidu.com/item/%E8%99%9A%E6%8B%9F%E5%8C%96/547949)ã€‚å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨[æ²™ç®±](https://baike.baidu.com/item/%E6%B2%99%E7%AE%B1/393318)æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚

Docker ä¼˜ç‚¹å¦‚ä¸‹ï¼š

1.  è¿è¡Œé€Ÿåº¦å¿«ï¼Œå¯åŠ¨ï¼Œåœæ­¢ï¼Œå¼€å§‹ï¼Œé‡å¯ç­‰ç­‰æ“ä½œéƒ½æ˜¯ä»¥ç§’æˆ–æ¯«ç§’ä¸ºå•ä½çš„ï¼›
2.  è½»é‡ï¼Œæœ€å°çš„æˆæœ¬å®Œæˆä¸€ä¸ªè™šæ‹Ÿæœºå¸¦æ¥çš„æ•ˆæœï¼›
3.  ç¯å¢ƒéš”ç¦»ï¼Œæ¯ä¸ª Docker éƒ½å¯ä»¥å•ç‹¬å¯åŠ¨ï¼Œå¤©ç„¶çš„ç¯å¢ƒéš”ç¦»ä¼˜åŠ¿ï¼›
4.  è·¨æ®µè¿è¡Œï¼ŒDocker çš„è¿è¡Œä¸é™äºå®¿ä¸»ç³»ç»Ÿï¼Œå¯ä»¥è¿è¡Œåœ¨å¤šç§å®¿ä¸»ç³»ç»Ÿä¸­ï¼›
5.  é›†æˆï¼Œä½¿ç”¨ Docker compose å¯ä»¥é›†æˆä¸€æ•´å¥—é¡¹ç›®è¿è¡Œç¯å¢ƒï¼›
6.  äº‘ç«¯ï¼ŒDocker ç›®å‰åœ¨å„å¤§äº‘æœåŠ¡é‡Œé¢æ˜¯é›†æˆæ¯”è¾ƒç®€å•ä¹Ÿå‹å¥½çš„

#### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Docker

è™½ç„¶ Docker çš„ä¼˜ç‚¹éå¸¸å¤šï¼Œæ¯”å¦‚ä¸Šé¢æ‰€è¯´çš„**ç¯å¢ƒéš”ç¦»**ã€**è·¨ç«¯è¿è¡Œ**ç­‰ç­‰ã€‚ä½†æ˜¯è¦æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œåœ¨æˆ‘ä»¬çš„ DevOps ä¸­**ä¸ºä»€ä¹ˆ**è¦å¼•å…¥ Dockerï¼Ÿ

é¦–å…ˆä»»ä½•ä¸€ç§æŠ€æœ¯çš„å¼•å…¥æˆ–è€…æµç¨‹çš„æ”¹è¿›éƒ½æ˜¯éœ€è¦æˆæœ¬çš„ï¼Œå¦‚æœå¼•å…¥æ–°æŠ€æœ¯çš„æˆæœ¬è¿œå¤§äºç›®å‰çš„å¯æ¥å—èŒƒå›´ï¼Œé‚£ä¹ˆè¿™ä¸ªæŠ€æœ¯æ˜¯å¦ä¾ç„¶å€¼å¾—å¼•å…¥ï¼Ÿ

å‡å¦‚åªæ˜¯ä¸ºäº†å•çº¯ä½¿ç”¨çš„æ–°æŠ€æœ¯ï¼Œé‚£ä¹ˆæ–°æŠ€æœ¯å¼•å…¥å¸¦æ¥çš„å‰¯ä½œç”¨æ˜¯å¦èƒ½æ‰¿å—ï¼Œæœ‰æ²¡æœ‰é¢„å¤‡æ–¹æ¡ˆè¿›è¡Œå…œåº•ï¼Œè¿™éƒ½æ˜¯éœ€è¦å»è€ƒè™‘çš„ã€‚

åœ¨å®Œæˆä¸Šè¿°ä¸€ç³»åˆ—ç®€å•çš„æ€è€ƒç¡®è®¤å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥ä¹‹åï¼Œå†è€ƒè™‘æ¥å…¥ Dockerã€‚

å¸‚é¢ä¸Šä¸å°‘å‰ç«¯å‘å¸ƒéƒ½æ˜¯å°†é¡¹ç›®ä»£ç åœ¨ Docker è¿›è¡Œæ„å»ºï¼Œå†åœ¨ Docker é‡Œé¢å¯åŠ¨ä¸€ä¸ª Nginx æœåŠ¡ï¼Œæä¾›é™æ€èµ„æºè®¿é—®ï¼Œè¿™æ ·ç¡®å®æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä»…ä»…æ˜¯é™æ€èµ„æºçš„è¯ï¼Œè¿™ç§æ“ä½œæ˜¯æœ‰ç‚¹è¿‡äºæ²‰é‡çš„ã€‚æ„å»ºå®Œæˆç›´æ¥å°†é™æ€èµ„æºä¸Šä¼ åˆ°æ–‡ä»¶æœåŠ¡å™¨ä¾‹å¦‚ COS æˆ–è€… OSS ä¸­ï¼Œæ˜¾ç„¶æ˜¯æ›´ä¸ºæ–¹ä¾¿çœäº‹ã€‚

> å½“ç„¶å¦‚æœå‘å¸ƒçš„æ˜¯ Nodejs è¿™ç§çš„åç«¯ç³»ç»Ÿï¼Œé‚£ä¹ˆé‡‡ç”¨è¿™ç§æ„å»ºæ¨¡å¼é…åˆ k8s æ˜¯å¾ˆæ­£å¸¸ã€‚

åœ¨æˆ‘ä»¬çš„ DevOps è®¾è®¡ä¸­ï¼Œæ˜¯æƒ³**å°½å¯èƒ½çš„å‡å°‘** Jenkins job çš„æ„å»ºè„šæœ¬å¼€å‘ï¼Œä½¿ç”¨ä¸€å¥—ã€æˆ–è€…æœ€å°‘çš„ job å»é€‚é…æ‰€æœ‰çš„é¡¹ç›®æ„å»ºä¸éƒ¨ç½²ã€‚æ‰€ä»¥ Docker å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ç¯å¢ƒéš”ç¦»ï¼Œå®ƒå¯ä»¥å°†æˆ‘ä»¬çš„ä¹‹å‰è®¾è®¡çš„æ„å»º CLI å°è£…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒä¸­å»ï¼Œå¦‚æ­¤æˆ‘ä»¬å¯ä»¥é‡å¤åˆ©ç”¨ä¸€å¥—æµç¨‹è„šæœ¬ï¼Œé€šè¿‡å¼•ç”¨ä¸åŒçš„ Builder Dockerï¼Œè¾¾åˆ°é€‚é…å¤šé¡¹ç›®éƒ¨ç½²çš„ç›®çš„ã€‚

## Docker \&\& DevOps æµç¨‹

### Docker å®‰è£…

Docker çš„å®‰è£…å¾ˆç®€å•ï¼Œæ— è®ºæ˜¯ windows è¿˜æ˜¯ mac ç”¨æˆ·ï¼Œæœ€æ–¹ä¾¿çš„ç›´æ¥ç‚¹å‡»[ä¸‹è½½](https://www.docker.com/products/docker-desktop)ä¸€ä¸ª Desktop ç‰ˆæœ¬å°±è¡Œäº†ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5a5f253c056438caeeedc0b1093e2de~tplv-k3u1fbpfcp-watermark.image)

å®‰è£…å®Œæ¯•ï¼Œå‘½ä»¤è¡Œè¾“å…¥ `docker`ï¼Œå‡ºç°å¦‚ä¸‹ç•Œé¢å³ä»£è¡¨å®‰è£…æˆåŠŸã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb3db1faf5744f75a22097e41785f64f~tplv-k3u1fbpfcp-watermark.image)

> window å®‰è£… docker çš„æ—¶å€™å¯èƒ½éœ€è¦ [ä¸‹è½½ Linux å†…æ ¸æ›´æ–°åŒ…](https://docs.microsoft.com/zh-cn/windows/wsl/install-win10#step-4---download-the-linux-kernel-update-package)ï¼Œå‚è€ƒé“¾æ¥é…ç½®å³å¯ã€‚

### å°è£…æ„å»º Docker é•œåƒ

é¦–å…ˆæ‰“å¼€æˆ‘ä»¬çš„ CLI é¡¹ç›®ï¼Œç„¶åæ–°å»ºä¸€ä¸ª Dockerfileï¼Œæ„å»ºæˆ‘ä»¬çš„é•œåƒã€‚

```docker
FROM node:alpine

WORKDIR /home/app

COPY . /home/app

RUN npm link
```

è¾“å…¥ä¸Šè¿°è„šæœ¬ä¹‹åï¼Œæˆ‘ä»¬è¿è¡Œ `docker build \-f ./Dockerfile \-t boty-builder:0.0.1 .` æ¥æ‰“åŒ…æˆ‘ä»¬çš„æ„å»ºé•œåƒã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee60bb20c7114bb7a904560b140ce213~tplv-k3u1fbpfcp-watermark.image)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¤æ—¶ï¼Œå·²ç»åœ¨æ‹‰å– `node:alpine` é•œåƒæ„å»ºäº†ã€‚

æ„å»ºå®Œæ¯•ä¹‹åï¼Œè¾“å…¥å‘½ä»¤ `docker images` å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰“åŒ…çš„é•œåƒäº†ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3bc25293931049819f355877868cc9ca~tplv-k3u1fbpfcp-watermark.image)

### ä½¿ç”¨é•œåƒæ„å»ºé¡¹ç›®

å†å®Œæˆæ„å»ºé•œåƒçš„æ‰“åŒ…ä¹‹åï¼Œç°åœ¨æˆ‘ä»¬æ‰“å¼€ä¹‹å‰åˆ›å»ºçš„ react-tpl é¡¹ç›®ï¼Œè¿è¡Œå‘½ä»¤ `docker run \-it \-v D:\self_git\react-tpl:/home/app/react boty-builder:0.0.1 sh`

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17a3405cf1ba42e8a366e4da3ec65a3f~tplv-k3u1fbpfcp-watermark.image)

è¿›å…¥ä¹‹åï¼Œè¿›å…¥åˆ° Docker æŒ‚è½½ç›®å½•ï¼Œè¿è¡Œæ„å»ºå‘½ä»¤ `NODE_ENV=production boty webpack`ï¼Œ æ­¤æ—¶å¯ä»¥çœ‹åˆ°æ„å»ºå®Œæˆä¹‹åï¼Œå®¿ä¸»ç›®å½•é‡Œé¢å·²ç»æ­£å¸¸ç”Ÿæˆæ„å»ºäº§ç‰©ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/813bc0b9529d4a51bf41639a883de01f~tplv-k3u1fbpfcp-watermark.image)

å½“ç„¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æ‰‹åŠ¨å»åšè¿™ä»¶äº‹ï¼Œæ‰€ä»¥åœ¨é¡¹ç›®æ ¹è·¯å¾„åˆ›å»ºä¸€ä¸ª shell è„šæœ¬ `build.sh`ï¼Œå†™å…¥å¦‚ä¸‹è„šæœ¬ã€‚

```sh
docker run -it -v D:\self_git\react-tpl:/home/app/react boty-builder:0.0.1 sh -c 'cd /home/app/react && NODE_ENV=production boty webpack && exit'
```

ç„¶åç›´æ¥è¿è¡Œå³å¯ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªç¼ºç‚¹ï¼Œæˆ‘ä»¬è¾“å…¥ `docker ps \-a` çœ‹çœ‹ä¼šå‡ºç°ä»€ä¹ˆã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d99710b7c139430ebd94f39b082dda3c~tplv-k3u1fbpfcp-watermark.image)

emmï¼Œæˆ‘ä»¬æ¯ä¸€æ¬¡è¿è¡Œ `boty-builder:0.0.1` éƒ½ä¼šå‡ºç°ä¸€ä¸ªå®¹å™¨ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡æ„å»ºéƒ½æœ‰ä¸€æ¬¡å®¹å™¨æ®‹ç•™ï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ docker çš„å‘½ä»¤ä¸­åŠ å…¥ `--rm`ï¼Œè¿™æ ·è¿è¡Œä¹‹åä¼šç›´æ¥åˆ é™¤å®¹å™¨ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•ä¸€éæ­£å¼æµç¨‹ï¼Œé¦–å…ˆä½¿ç”¨ `docker rm $(docker ps \-aq)`ï¼Œåˆ é™¤æ‰€æœ‰å®¹å™¨

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e0679a6f2f644369a24049159696bc60~tplv-k3u1fbpfcp-watermark.image)

å†æ¬¡è¿è¡Œæ”¹é€ åçš„è„šæœ¬`docker run \-it \--rm \-v D:\self_git\react-tpl:/home/app/react boty-builder:0.0.1 sh \-c 'cd /home/app/react && NODE_ENV=production boty webpack && exit'`

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae7300c4414e4a8c949663995a5f02d0~tplv-k3u1fbpfcp-watermark.image)

æ­¤æ—¶å¯ä»¥çœ‹åˆ°ï¼Œæ„å»ºå®Œæˆä¹‹åï¼Œè‡ªåŠ¨é€€å‡ºå®¹å™¨ä¸”å®¹å™¨å·²ç»è¢«åˆ é™¤äº†ã€‚

## æœ¬ç« å°ç»“

åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬åˆ©ç”¨äº† Docker ç”Ÿæˆäº†æ„å»ºé•œåƒæ¥æ‰“åŒ…é¡¹ç›®ï¼ŒåŒæ—¶åˆ©ç”¨å¿«é€Ÿå¯åŠ¨ä»¥åŠç¯å¢ƒéš”ç¦»çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒçš„é¡¹ç›®ç”Ÿæˆä¸åŒçš„æ„å»ºé•œåƒã€‚

æ­¤æ—¶è‚¯å®šä¹Ÿæœ‰åŒå­¦æœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè¾›è‹¦ç”Ÿæˆä¸€ä¸ªä¸“é—¨æ„å»ºé¡¹ç›®çš„é•œåƒï¼Œç›´æ¥ä¸‹è½½æºç æ„å»ºä¸æ˜¯æ›´ä¸ºæ–¹ä¾¿å—ï¼Ÿé’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œåœ¨ä¸€ç« èŠ‚çš„ Jenkins è¿›é˜¶ä¸­ä¼šæœ‰å±•è¿°ã€‚

æœ¬ç« çš„å­¦ä¹ é’ˆå¯¹äº Docker æ–°æ‰‹æ¥è¯´ï¼Œä¼šæœ‰è¯¸å¤šé—®é¢˜ï¼Œä½† Docker æ€»ä½“çš„å­¦ä¹ æˆæœ¬ä¸ç®—å¾ˆé«˜ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å‘½ä»¤ç›¸å…³çš„ç†Ÿæ‚‰ï¼ŒåŒæ—¶è¿™äº›ä¹Ÿæ˜¯ä½œä¸º Docker å¼€å‘çš„åŸºç¡€åŠŸèƒ½ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰è¿‡å¤šçš„ä»‹ç»å‘½ä»¤ç›¸å…³çš„å†…å®¹ã€‚

å¦‚æœä½ æœ‰ä»€ä¹ˆç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºï¼Œæˆ–è€…åŠ ç¾¤æ²Ÿé€šã€‚ ğŸ‘
    